---
title: Running Containers as Root (CIS 4.1)
description: Security risks and mitigation strategies for containers running with root privileges
---

## Impact & Risk Analysis
| **Severity** | **High** |
| :--- | :--- |
| **CIS Benchmark** | CIS 4.1 |
| **Impact** | **Container Escape.** Running as root increases the attack surface. If a vulnerability (like a buffer overflow) is exploited, the attacker immediately has root privileges inside the container, making it significantly easier to break out to the host. |

## Common Misconfiguration

Running containers as the root user (UID 0) is a critical security risk. If an attacker compromises the application, they gain root privileges within the container, potentially leading to container escape or host compromise.

## Vulnerable Example

```dockerfile
# Vulnerable Dockerfile
FROM node:18-alpine

# No user specified - runs as root by default
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .

EXPOSE 3000
CMD ["node", "server.js"]

```

## Secure Example

```dockerfile
# Secure Dockerfile
FROM node:18-alpine

# 1. Create a non-root user
# (Note: For Debian/Ubuntu images, use: useradd -m -u 1001 nodejs)
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001

WORKDIR /app

# 2. Change ownership of the app directory so the user can access it
COPY --chown=nodejs:nodejs package*.json ./

# 3. Switch to non-root user before installing dependencies
USER nodejs

RUN npm install
COPY --chown=nodejs:nodejs . .

EXPOSE 3000
CMD ["node", "server.js"]

```

## Additional Security Measures

```yaml
# docker-compose.yml with security context
version: '3.8'
services:
  app:
    build: .
    # Ensure the container runs as the specific user ID
    user: "1001:1001"
    # Prevent the container from gaining new privileges (e.g., sudo)
    security_opt:
      - no-new-privileges:true
    # Make the root filesystem read-only for extra security
    read_only: true
    tmpfs:
      - /tmp

```

## Verification

```bash
# Check the user running inside the container
docker exec <container-id> whoami
# Should output: nodejs (not root)

# Verify UID
docker exec <container-id> id
# Should show: uid=1001(nodejs) gid=1001(nodejs)

```
