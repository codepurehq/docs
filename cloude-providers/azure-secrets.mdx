---
title: Azure Secrets Exposure
description: Detecting and preventing Azure credentials in code
---

## Common Misconfiguration

Exposed Azure service principal credentials and storage keys can compromise your entire Azure subscription.

### Vulnerable Example



## Secure Example

```javascript
// SECURE - Using managed identity and Key Vault
const { DefaultAzureCredential } = require("@azure/identity");
const { SecretClient } = require("@azure/keyvault-secrets");

// Use managed identity (no credentials needed)
const credential = new DefaultAzureCredential();

// Retrieve secrets from Key Vault
const keyVaultUrl = process.env.KEY_VAULT_URL;
const secretClient = new SecretClient(keyVaultUrl, credential);

async function getStorageConnectionString() {
    const secret = await secretClient.getSecret("storage-connection-string");
    return secret.value;
}

async function getCosmosDBConfig() {
    const endpoint = process.env.COSMOS_ENDPOINT;
    const keySecret = await secretClient.getSecret("cosmos-key");
    
    return {
        endpoint: endpoint,
        key: keySecret.value,
        database: process.env.DATABASE_NAME
    };
}

// Use environment variables for non-sensitive config
const config = {
    tenantId: process.env.AZURE_TENANT_ID,
    subscriptionId: process.env.AZURE_SUBSCRIPTION_ID
};
```

## Detection Patterns

  * Azure Client Secret: [a-zA-Z0-9~._-]{34,}.
  * Storage Account Key: [a-zA-Z0-9/+=]{86}==.
  * CosmosDB Key: [a-zA-Z0-9=]{86}==.

## Prevention Best Practices

  1. Use Managed Service Identity (MSI) where possible.
  2. Store secrets in Azure Key Vault.
  3. Use Azure App Configuration for settings.
  4. Implement RBAC with least privilege.
  5. Enable Azure Policy for compliance.
  6. Rotate secrets automatically.