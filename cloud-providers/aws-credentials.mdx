---
title: AWS Credentials Exposure
description: Detecting and preventing AWS access keys and secrets in code
---

# AWS Credentials Exposure

## Common Misconfiguration

AWS credentials hardcoded in source code expose your entire AWS infrastructure to unauthorized access.

### Vulnerable Example

```python
# VULNERABLE - Hardcoded AWS credentials
import boto3

# Never do this!
AWS_ACCESS_KEY_ID = "AKIAIOSFODNN7EXAMPLE"
AWS_SECRET_ACCESS_KEY = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
AWS_SESSION_TOKEN = "AQoDYXdzEJr...EXAMPLETOKEN"

s3_client = boto3.client(
    's3',
    aws_access_key_id=AWS_ACCESS_KEY_ID,
    aws_secret_access_key=AWS_SECRET_ACCESS_KEY,
    aws_session_token=AWS_SESSION_TOKEN
)

# Hardcoded RDS password
rds_connection = {
    "host": "mydb.123456789012.us-east-1.rds.amazonaws.com",
    "password": "MyRDSPassword123!",
    "user": "admin",
    "database": "production"
}
```

## Secure Example

```python
# SECURE - Using environment variables and IAM roles
import boto3
import os
from aws_secretsmanager import get_secret

# Use IAM roles when running on EC2/ECS/Lambda
s3_client = boto3.client('s3')

# Or use environment variables for local development
s3_client = boto3.client(
    's3',
    aws_access_key_id=os.environ.get('AWS_ACCESS_KEY_ID'),
    aws_secret_access_key=os.environ.get('AWS_SECRET_ACCESS_KEY')
)

# Use AWS Secrets Manager for RDS passwords
def get_rds_credentials():
    secret_name = "prod/rds/credentials"
    secrets_client = boto3.client('secretsmanager')
    response = secrets_client.get_secret_value(SecretId=secret_name)
    return json.loads(response['SecretString'])

rds_connection = get_rds_credentials()
```

## Detection Patterns

  * AWS Access Key: AKIA[0-9A-Z]{16}.
  * AWS Secret Key: [0-9a-zA-Z/+=]{40}.
  * AWS Session Token: FwoGZXIvYXdzE[0-9a-zA-Z/+=]+.

## Prevention Best Practices

  1. Use IAM roles for EC2, ECS, and Lambda.
  2. Store credentials in AWS Secrets Manager or Parameter Store.
  3. Use temporary credentials with STS.
  4. Implement least privilege access policies.
  5. Enable MFA for sensitive operations.
  6. Rotate credentials regularly.

  